<div id="vk_comments_{{ .Page.File.UniqueID }}" class="vk-comments-widget">
    <!-- –°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div class="vk-comments-loading">
        <div class="loading-spinner"></div>
        <p>–ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏...</p>
    </div>
    <!-- –°–æ—Å—Ç–æ—è–Ω–∏–µ –æ—à–∏–±–∫–∏ (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç–æ) -->
    <div class="vk-comments-error" style="display: none;">
        <div class="error-icon">üí¨</div>
        <h3>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã</h3>
        <p>–û–±—Å—É–¥–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª –º–æ–∂–Ω–æ –≤ –Ω–∞—à–µ–π –≥—Ä—É–ø–ø–µ VK</p>
        <a href="{{ .Site.Params.vk.groupUrl | default "https://vk.com" }}" target="_blank" class="vk-link">–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–±—Å—É–∂–¥–µ–Ω–∏—é</a>
    </div>
</div>

<script type="text/javascript">
// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å–∞–π—Ç–∞
const vkConfig = {
    appId: "{{ .Site.Params.vk.appId }}", // –ë–µ—Ä—ë–º –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
    limit: {{ .Get "limit" | default 10 }},
    pageUrl: "{{ .Page.Permalink }}",
    pageId: "{{ .Page.File.UniqueID }}",
    groupUrl: "{{ .Site.Params.vk.groupUrl | default "https://vk.com" }}"
};

// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ –≤–∏–¥–∂–µ—Ç–∞
function showElement(selector, show) {
    const el = document.querySelector(`#vk_comments_${vkConfig.pageId} ${selector}`);
    if (el) el.style.display = show ? 'flex' : 'none';
}

// –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–∏–¥–∂–µ—Ç–∞ VK
function initVKWidget() {
    const containerId = `vk_comments_${vkConfig.pageId}`;
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏, —Å–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
    showElement('.vk-comments-loading', true);
    showElement('.vk-comments-error', false);

    // –ï—Å–ª–∏ VK API –∑–∞–≥—Ä—É–∂–µ–Ω, —Å–æ–∑–¥–∞—ë–º –≤–∏–¥–∂–µ—Ç
    if (window.VK && VK.Widgets) {
        VK.Widgets.Comments(containerId, {
            limit: vkConfig.limit,
            pageUrl: vkConfig.pageUrl,
            attach: false
        }, vkConfig.appId);

        // –ß–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã –ø—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–≥—Ä—É–∑–∏–ª—Å—è –ª–∏ –≤–∏–¥–∂–µ—Ç
        setTimeout(() => {
            const container = document.getElementById(containerId);
            const hasWidget = container && container.querySelector('iframe, .vk_widget');
            if (hasWidget) {
                // –í–∏–¥–∂–µ—Ç –∑–∞–≥—Ä—É–∑–∏–ª—Å—è —É—Å–ø–µ—à–Ω–æ
                showElement('.vk-comments-loading', false);
            } else {
                // –í–∏–¥–∂–µ—Ç –Ω–µ –ø–æ—è–≤–∏–ª—Å—è, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
                showElement('.vk-comments-loading', false);
                showElement('.vk-comments-error', true);
            }
        }, 3000);
    } else {
        // –ï—Å–ª–∏ VK API –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å
        console.error('VK Widgets API not loaded');
        showElement('.vk-comments-loading', false);
        showElement('.vk-comments-error', true);
    }
}

// –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ VK API
function loadVKAPI() {
    // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Å–∫—Ä–∏–ø—Ç, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
    const oldScript = document.querySelector('script[src*="vk.com/js/api"]');
    if (oldScript) oldScript.remove();

    const script = document.createElement('script');
    script.src = 'https://vk.com/js/api/openapi.js?169';
    script.async = true;
    
    script.onload = initVKWidget;
    script.onerror = () => {
        // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å API
        showElement('.vk-comments-loading', false);
        showElement('.vk-comments-error', true);
    };
    
    document.head.appendChild(script);
}

// –ó–∞–≥—Ä—É–∂–∞–µ–º VK API –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', loadVKAPI);
} else {
    loadVKAPI();
}
</script>

<style>
.vk-comments-widget {
    margin: 40px 0;
    min-height: 200px;
    position: relative;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ */
.vk-comments-loading {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 40px 20px;
    text-align: center;
    color: #666;
}

.loading-spinner {
    width: 40px;
    height: 40px;
    border: 4px solid #e5e5e5;
    border-top-color: #4C75A3; /* –¶–≤–µ—Ç VK */
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-bottom: 16px;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ—à–∏–±–∫–∏ */
.vk-comments-error {
    display: none; /* –°–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 40px 20px;
    text-align: center;
    background: #f9f9f9;
    border-radius: 12px;
    border: 1px solid #e5e5e5;
}

.error-icon {
    font-size: 48px;
    margin-bottom: 16px;
}

.vk-comments-error h3 {
    margin: 0 0 8px 0;
    color: #333;
}

.vk-comments-error p {
    margin: 0 0 20px 0;
    color: #666;
}

.vk-link {
    display: inline-block;
    padding: 10px 24px;
    background-color: #4C75A3;
    color: white;
    text-decoration: none;
    border-radius: 8px;
    font-weight: 500;
    transition: background-color 0.2s;
}

.vk-link:hover {
    background-color: #3B5F8A;
}
</style>

<!-- –°—Ç–∞—Ä—ã–π –≤–∞—Ä–∏–∞–Ω—Ç VK -->
<!-- <div id="vk_comments_{{ .Page.File.UniqueID }}" class="vk-comments-widget"></div>

<script type="text/javascript">
// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
var vkConfig = {
    appId: "{{ .Get "appId" | default "5165443" }}",
    limit: {{ .Get "limit" | default "10" }},
    attach: "{{ .Get "attach" | default "*" }}",
    autoPublish: {{ .Get "autoPublish" | default "1" }}
};

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
window.vkAsyncInit = function() {
    VK.init({
        apiId: vkConfig.appId,
        onlyWidgets: true
    });
    
    VK.Widgets.Comments("vk_comments_{{ .Page.File.UniqueID }}", {
        limit: vkConfig.limit,
        attach: vkConfig.attach,
        autoPublish: vkConfig.autoPublish,
        pageUrl: "{{ .Page.Permalink }}"
    });
};

// –ó–∞–≥—Ä—É–∑–∫–∞ VK API
var script = document.createElement('script');
script.src = 'https://vk.com/js/api/openapi.js?169';
script.async = true;
script.onload = function() {
    if (window.VK && window.vkAsyncInit) {
        window.vkAsyncInit();
    }
};
document.head.appendChild(script);
</script>

<style>
.vk-comments-widget {
    margin: 40px 0;
    padding-top: 20px;
    border-top: 2px solid var(--border-color);
}
</style> -->